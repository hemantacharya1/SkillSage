---
description: 
globs: 
alwaysApply: false
---
# ğŸ“˜ AI Agent Backend Coding Rulebook

### For: AI-Powered Coding Interview Platform

**Version:** 1.0\
**Last Updated:** 2025-06-13

---

## ğŸ¯ Objective

Provide strict and unambiguous coding guidelines for any AI coding agent working on the backend of this project, so it **does not hallucinate**, re-invent, or deviate from the intended architecture.

---

## âš™ï¸ Project Constraints

- **Tech Stack:** Spring Boot (Java), PostgreSQL
- **Authentication:** JWT-based (Access Token only, stored in `localStorage`)
- **AI Integration:** Gemini API for post-submission evaluation
- **Deployment:** Docker Compose on EC2 (manual push/pull)
- **Frontend Deployment:** Vercel or Netlify
- **Real-Time:** WebSocket used for interview timer & shared notes only

---

## ğŸ§­ Folder Structure Rules

### âœ… Use Package-by-Feature:

Each major feature (e.g., auth, recruiter, candidate, interview, submission) must be in its own sub-package.

```
com.yourcompany.aiplatform/
â”œâ”€â”€ auth/
â”œâ”€â”€ recruiter/
â”œâ”€â”€ candidate/
â”œâ”€â”€ interview/
â”œâ”€â”€ submission/
â”œâ”€â”€ feedback/
â”œâ”€â”€ websocket/
â”œâ”€â”€ common/
```

**âŒ Never group files by layers (e.g., all controllers in one place).**

---

## ğŸ“¦ Inside Each Feature Package

Each feature package must follow this structure:

```
feature/
â”œâ”€â”€ controller/
â”œâ”€â”€ service/
â”œâ”€â”€ dto/
â”œâ”€â”€ model/         â† Only if feature defines its own DB models
â”œâ”€â”€ repository/
```

> Example: `auth/service/AuthService.java`, `recruiter/dto/CreateInterviewRequest.java`

---

## ğŸ›¡ï¸ Authentication Rules

- Use `JWT` for access tokens.
- Token expiration: **24 hours**
- Store token on frontend via `localStorage`.
- Spring Security must restrict all `/api/...` endpoints by role.

### Auth Endpoints:

```
/api/auth/register
/api/auth/login
/api/auth/forgot-password
/api/auth/reset-password
```

---

## ğŸ§¾ API Route Convention

- All routes must be prefixed with `/api`
- Recruiter routes â†’ `/api/recruiter/...`
- Candidate routes â†’ `/api/candidate/...`
- Auth routes â†’ `/api/auth/...`

Use RESTful patterns:

- `GET /api/recruiter/interviews`
- `POST /api/candidate/interview/:id/submit`

**âŒ Never use snake\_case in URLs**

---

## ğŸ”„ DTO Guidelines

- Every public-facing API **must** use DTOs.
- Use methods **inside DTOs** for mapping from/to entity.
- Do **not** use MapStruct or libraries for mapping.

Example:

```java
public static UserDTO from(User user) {
    return new UserDTO(user.getId(), user.getEmail(), user.getName());
}
```

---

## ğŸ API Response Format

All APIs must return this consistent response wrapper:

```json
{
  "success": true,
  "message": "Interview created successfully.",
  "data": { ... }
}
```

Create a `common.response.ApiResponse<T>` class for this.\
Use `@RestControllerAdvice` and custom exceptions for uniform error handling.

---

## ğŸ“œ Swagger Support

- Enable Swagger/OpenAPI from the start using SpringDoc.
- Annotate all controller methods with summaries.

> Do not hallucinate custom API doc formats. Stick with standard OpenAPI annotations.

---

## ğŸ§  Gemini Integration

- Feedback must be stored in the DB.
- Recruiter must manually trigger evaluation.
- AI response format = Markdown (easy to display on frontend).
- No plagiarism detection in v1.

Use service: `feedback/service/GeminiEvaluationService.java`

---

## ğŸ”Œ WebSocket Rules

- WebSocket is **only used** for:
  - Shared notes (`noteUpdate`)
  - Interview timer (`timerStart`, `timerEnd`)
  - Lock candidate session (`sessionLock`)

### Endpoint:

```
/ws/interview/:id
```

No need for WebSocket token-based auth unless security becomes a concern.

---

## ğŸ˜ Database Rules

- Use **PostgreSQL**
- Table names should be `snake_case` plural (e.g., `interviews`, `submissions`)
- Use `@Entity`, `@Table(name = "...")` and proper `@JoinColumn`

No audit logs, transcripts, or snapshots are stored.

---

## ğŸ’Œ Email Rules

- Use basic SMTP integration.
- Use `JavaMailSender`
- Recruiter email invite will include the interview join link.
- Email templates must be used for formatting (plain text is sufficient).

---

## ğŸ” Security Rules

- Use Spring Security + JWT filter
- `@PreAuthorize` for route-level access control
- Only authenticated users can access anything under `/api/...`

No role = No access.

---

## ğŸ³ Docker & Deployment

- Backend is containerized with Docker
- Docker Compose includes:
  - Spring Boot app
  - PostgreSQL
- Admin tools (like pgAdmin) are optional
- No RDS is used
- CI/CD not required; Docker images are manually pushed/pulled

---

## â›” Anti-Hallucination Rules

1. âŒ **Never expose Entity classes to the client**
2. âŒ **Never create routes not defined in PRD**
3. âŒ **Never assume extra features (like tags, PDF, calendar sync)**
4. âŒ **Do not write live code execution in-browser â€” it's backend-only via Judge0 or similar**
5. âŒ **Do not write WebSocket for chat/collaboration outside notes/timer**

---

## ğŸ§ª Optional Conventions

| Concern          | Decision              |
| ---------------- | --------------------- |
| Logging          | Use SLF4J / `@Slf4j`  |
| Email Templates  | Basic text format     |
| DB Migration     | Add Flyway (optional) |
| Password Hashing | Use BCrypt            |
| Testing          | JUnit + Mockito       |


